---
alwaysApply: false
---
# Vue 3 Computed vs Watcher ä½¿ç”¨å ´æ™¯æŒ‡å—

ç°¡çŸ­æè¿°ï¼šæœ¬æ–‡ä»¶è©³ç´°èªªæ˜ Vue 3 ä¸­ `computed` èˆ‡ `watcher` çš„ç›¸åŒèˆ‡ä¸åŒä¹‹è™•ï¼Œæä¾›æ˜ç¢ºçš„åˆ¤æ–·æ¨™æº–ä¾†é¸æ“‡é©ç•¶çš„ä½¿ç”¨å ´æ™¯ã€‚

æœ€å¾Œæ›´æ–°ï¼š2024-12-19

---

## æ ¸å¿ƒæ¦‚å¿µå°æ¯”

### ç›¸åŒä¹‹è™•

| ç‰¹æ€§ | computed | watcher |
|------|----------|---------|
| **åæ‡‰å¼** | âœ… éŸ¿æ‡‰è³‡æ–™è®ŠåŒ– | âœ… éŸ¿æ‡‰è³‡æ–™è®ŠåŒ– |
| **è‡ªå‹•æ›´æ–°** | âœ… ä¾è³´æ”¹è®Šæ™‚è‡ªå‹•é‡æ–°è¨ˆç®— | âœ… ç›£è½çš„è³‡æ–™æ”¹è®Šæ™‚è‡ªå‹•åŸ·è¡Œ |
| **Vue 3 æ”¯æ´** | âœ… å®Œæ•´æ”¯æ´ | âœ… å®Œæ•´æ”¯æ´ |
| **çµ„åˆå¼ API** | âœ… æ”¯æ´ | âœ… æ”¯æ´ |

### é—œéµå·®ç•°

| ç‰¹æ€§ | computed | watcher |
|------|----------|---------|
| **ä¸»è¦ç”¨é€”** | è¨ˆç®—è¡ç”Ÿå€¼ | åŸ·è¡Œå¤–éƒ¨å½±éŸ¿æ“ä½œ |
| **è¿”å›å€¼** | å¿…é ˆæœ‰è¿”å›å€¼ | é€šå¸¸ç„¡è¿”å›å€¼ |
| **å¿«å–æ©Ÿåˆ¶** | âœ… æœ‰å¿«å–ï¼Œä¾è³´ä¸è®Šä¸é‡æ–°è¨ˆç®— | âŒ ç„¡å¿«å–ï¼Œæ¯æ¬¡è§¸ç™¼éƒ½åŸ·è¡Œ |
| **åŒæ­¥æ€§** | âœ… åŒæ­¥è¨ˆç®— | âœ… å¯åŒæ­¥æˆ–ç•°æ­¥ |
| **å¤–éƒ¨å½±éŸ¿** | âŒ ä¸æ‡‰æœ‰å¤–éƒ¨å½±éŸ¿ | âœ… å°ˆé–€è™•ç†å¤–éƒ¨å½±éŸ¿ |
| **æ•ˆèƒ½** | âœ… é«˜æ•ˆèƒ½ï¼ˆæœ‰å¿«å–ï¼‰ | âš ï¸ éœ€æ³¨æ„æ•ˆèƒ½å½±éŸ¿ |

---

## ä½¿ç”¨å ´æ™¯åˆ¤æ–·æ¨™æº–

### ğŸ¯ ä½¿ç”¨ `computed` çš„æƒ…æ³

#### 1. ç´”è¨ˆç®—ä»»å‹™
```vue
<script setup lang="ts">
const firstName = ref('John')
const lastName = ref('Doe')

// âœ… é©åˆï¼šç´”è¨ˆç®—ï¼Œç„¡å‰¯ä½œç”¨
const fullName = computed(() => {
  return `${firstName.value} ${lastName.value}`.trim()
})

const nameLength = computed(() => {
  return fullName.value.length
})
</script>
```

#### 2. è³‡æ–™éæ¿¾èˆ‡æ’åº
```vue
<script setup lang="ts">
const users = ref<User[]>([])
const searchQuery = ref('')
const sortBy = ref<'name' | 'age'>('name')

// âœ… é©åˆï¼šåŸºæ–¼ç¾æœ‰è³‡æ–™è¨ˆç®—æ–°è³‡æ–™
const filteredUsers = computed(() => {
  return users.value.filter(user => 
    user.name.toLowerCase().includes(searchQuery.value.toLowerCase())
  )
})

const sortedUsers = computed(() => {
  return [...filteredUsers.value].sort((a, b) => {
    return sortBy.value === 'name' 
      ? a.name.localeCompare(b.name)
      : a.age - b.age
  })
})
</script>
```

#### 3. æ ¼å¼åŒ–é¡¯ç¤ºè³‡æ–™
```vue
<script setup lang="ts">
const price = ref(1000)
const currency = ref('TWD')

// âœ… é©åˆï¼šæ ¼å¼åŒ–é¡¯ç¤º
const formattedPrice = computed(() => {
  return new Intl.NumberFormat('zh-TW', {
    style: 'currency',
    currency: currency.value
  }).format(price.value)
})

const displayText = computed(() => {
  return `åƒ¹æ ¼ï¼š${formattedPrice.value}`
})
</script>
```

#### 4. æ¢ä»¶æ€§ç‹€æ…‹åˆ¤æ–·
```vue
<script setup lang="ts">
const user = ref<User | null>(null)
const permissions = ref<string[]>([])

// âœ… é©åˆï¼šåŸºæ–¼å¤šå€‹ç‹€æ…‹è¨ˆç®—å¸ƒæ—å€¼
const canEdit = computed(() => {
  return user.value?.isActive && permissions.value.includes('edit')
})

const isAdmin = computed(() => {
  return user.value?.role === 'admin'
})
</script>
```

### ğŸ”„ ä½¿ç”¨ `watcher` çš„æƒ…æ³

#### 1. åŸ·è¡Œå¤–éƒ¨å½±éŸ¿æ“ä½œ
```vue
<script setup lang="ts">
const userId = ref<string | null>(null)
const userData = ref<User | null>(null)

// âœ… é©åˆï¼šç•¶ userId æ”¹è®Šæ™‚ï¼ŒåŸ·è¡Œå¤–éƒ¨å½±éŸ¿æ“ä½œï¼ˆAPI è«‹æ±‚ï¼‰
watch(userId, async (newUserId) => {
  if (newUserId) {
    try {
      const response = await $fetch(`/api/users/${newUserId}`)
      userData.value = response
    } catch (error) {
      console.error('Failed to fetch user:', error)
    }
  }
})
</script>
```

#### 2. æ“ä½œ DOM
```vue
<script setup lang="ts">
const isVisible = ref(false)
const elementRef = ref<HTMLElement>()

// âœ… é©åˆï¼šæ ¹æ“šç‹€æ…‹è®ŠåŒ–æ“ä½œ DOM
watch(isVisible, (visible) => {
  if (elementRef.value) {
    elementRef.value.style.display = visible ? 'block' : 'none'
  }
})
</script>
```

#### 3. æœ¬åœ°å„²å­˜åŒæ­¥
```vue
<script setup lang="ts">
const settings = ref<Settings>({})

// âœ… é©åˆï¼šå°‡ç‹€æ…‹åŒæ­¥åˆ°æœ¬åœ°å„²å­˜
watch(settings, (newSettings) => {
  localStorage.setItem('user-settings', JSON.stringify(newSettings))
}, { deep: true })
</script>
```

#### 4. è·¯ç”±å°èˆª
```vue
<script setup lang="ts">
const route = useRoute()
const searchQuery = ref('')

// âœ… é©åˆï¼šæ ¹æ“šè·¯ç”±è®ŠåŒ–åŸ·è¡Œæ“ä½œ
watch(() => route.query.q, (newQuery) => {
  if (newQuery) {
    searchQuery.value = newQuery as string
  }
})
</script>
```

#### 5. è¨ˆæ™‚å™¨èˆ‡å‹•ç•«
```vue
<script setup lang="ts">
const isAnimating = ref(false)
let animationTimer: number | null = null

// âœ… é©åˆï¼šç®¡ç†è¨ˆæ™‚å™¨å’Œå‹•ç•«
watch(isAnimating, (animating) => {
  if (animating) {
    animationTimer = window.setTimeout(() => {
      isAnimating.value = false
    }, 1000)
  } else {
    if (animationTimer) {
      clearTimeout(animationTimer)
      animationTimer = null
    }
  }
})
</script>
```

---

## å¸¸è¦‹æ··æ·†å ´æ™¯èˆ‡æ­£ç¢ºåšæ³•

### âŒ éŒ¯èª¤ï¼šç”¨ `watcher` åšç´”è¨ˆç®—

```vue
<script setup lang="ts">
const firstName = ref('John')
const lastName = ref('Doe')
const fullName = ref('')

// âŒ éŒ¯èª¤ï¼šç”¨ watcher åšç´”è¨ˆç®—
watch([firstName, lastName], ([newFirst, newLast]) => {
  fullName.value = `${newFirst} ${newLast}`.trim()
})
</script>

<template>
  <p>{{ fullName }}</p>
</template>
```

### âœ… æ­£ç¢ºï¼šç”¨ `computed` åšç´”è¨ˆç®—

```vue
<script setup lang="ts">
const firstName = ref('John')
const lastName = ref('Doe')

// âœ… æ­£ç¢ºï¼šç”¨ computed åšç´”è¨ˆç®—
const fullName = computed(() => {
  return `${firstName.value} ${lastName.value}`.trim()
})
</script>

<template>
  <p>{{ fullName }}</p>
</template>
```

### âŒ éŒ¯èª¤ï¼šç”¨ `computed` åŸ·è¡Œå¤–éƒ¨å½±éŸ¿æ“ä½œ

```vue
<script setup lang="ts">
const userId = ref<string | null>(null)

// âŒ éŒ¯èª¤ï¼šcomputed ä¸æ‡‰æœ‰å¤–éƒ¨å½±éŸ¿
const userData = computed(async () => {
  if (userId.value) {
    const response = await $fetch(`/api/users/${userId.value}`)
    return response // é€™æœƒé€ æˆå•é¡Œï¼
  }
  return null
})
</script>
```

### âœ… æ­£ç¢ºï¼šç”¨ `watcher` åŸ·è¡Œå¤–éƒ¨å½±éŸ¿æ“ä½œ

```vue
<script setup lang="ts">
const userId = ref<string | null>(null)
const userData = ref<User | null>(null)

// âœ… æ­£ç¢ºï¼šç”¨ watcher åŸ·è¡Œå¤–éƒ¨å½±éŸ¿æ“ä½œ
watch(userId, async (newUserId) => {
  if (newUserId) {
    try {
      const response = await $fetch(`/api/users/${newUserId}`)
      userData.value = response
    } catch (error) {
      console.error('Failed to fetch user:', error)
    }
  } else {
    userData.value = null
  }
})
</script>
```

---

## é€²éšä½¿ç”¨æ¨¡å¼

### 1. `computed` èˆ‡ `watcher` çš„çµ„åˆä½¿ç”¨

```vue
<script setup lang="ts">
const users = ref<User[]>([])
const selectedUserId = ref<string | null>(null)

// âœ… computedï¼šè¨ˆç®—ç•¶å‰é¸ä¸­çš„ä½¿ç”¨è€…
const selectedUser = computed(() => {
  return users.value.find(u => u.id === selectedUserId.value) || null
})

// âœ… watcherï¼šç•¶é¸ä¸­ä½¿ç”¨è€…æ”¹è®Šæ™‚ï¼ŒåŸ·è¡Œå¤–éƒ¨å½±éŸ¿æ“ä½œ
watch(selectedUser, (user) => {
  if (user) {
    // æ›´æ–°ç€è¦½å™¨æ¨™é¡Œ
    document.title = `ä½¿ç”¨è€…ï¼š${user.name}`
    
    // è¨˜éŒ„ä½¿ç”¨è€…é¸æ“‡
    console.log('Selected user:', user.name)
  }
})
</script>
```

### 2. æ¢ä»¶æ€§ `watcher`

```vue
<script setup lang="ts">
const isLoggedIn = ref(false)
const userProfile = ref<User | null>(null)

// âœ… æ¢ä»¶æ€§ watcherï¼šåªåœ¨ç™»å…¥æ™‚ç›£è½
watch(isLoggedIn, (loggedIn) => {
  if (loggedIn) {
    // ç™»å…¥æ™‚é–‹å§‹ç›£è½ä½¿ç”¨è€…è³‡æ–™è®ŠåŒ–
    watch(userProfile, (profile) => {
      if (profile) {
        // åŒæ­¥åˆ°æœ¬åœ°å„²å­˜
        localStorage.setItem('user-profile', JSON.stringify(profile))
      }
    }, { immediate: true })
  }
})
</script>
```

### 3. æ·±åº¦ç›£è½èˆ‡æ•ˆèƒ½å„ªåŒ–

```vue
<script setup lang="ts">
const formData = ref<FormData>({
  name: '',
  email: '',
  preferences: {
    theme: 'light',
    language: 'zh-TW'
  }
})

// âœ… æ·±åº¦ç›£è½ï¼šç›£è½ç‰©ä»¶å…§éƒ¨è®ŠåŒ–
watch(formData, (newData) => {
  // è‡ªå‹•å„²å­˜è¡¨å–®è³‡æ–™
  localStorage.setItem('form-draft', JSON.stringify(newData))
}, { deep: true })

// âœ… æ•ˆèƒ½å„ªåŒ–ï¼šåªç›£è½ç‰¹å®šå±¬æ€§
watch(() => formData.value.preferences.theme, (newTheme) => {
  // ä¸»é¡Œæ”¹è®Šæ™‚çš„ç‰¹æ®Šè™•ç†
  document.documentElement.setAttribute('data-theme', newTheme)
})
</script>
```

---

## æ±ºç­–æµç¨‹åœ–

```
éœ€è¦éŸ¿æ‡‰è³‡æ–™è®ŠåŒ–å—ï¼Ÿ
â”œâ”€ å¦ â†’ ä¸éœ€è¦ computed æˆ– watcher
â””â”€ æ˜¯ â†’ éœ€è¦è¿”å›å€¼å—ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ æœ‰å¤–éƒ¨å½±éŸ¿å—ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ â†’ âŒ é‡æ–°è¨­è¨ˆï¼Œåˆ†é›¢è¨ˆç®—å’Œå¤–éƒ¨å½±éŸ¿
    â”‚   â””â”€ å¦ â†’ âœ… ä½¿ç”¨ computed
    â””â”€ å¦ â†’ éœ€è¦åŸ·è¡Œå¤–éƒ¨å½±éŸ¿æ“ä½œå—ï¼Ÿ
        â”œâ”€ æ˜¯ â†’ âœ… ä½¿ç”¨ watcher
        â””â”€ å¦ â†’ è€ƒæ…®æ˜¯å¦çœŸçš„éœ€è¦éŸ¿æ‡‰å¼
```

---

## å…§å¤–éƒ¨å½±éŸ¿åˆ¤æ–·æ¨™æº–

### ğŸ  å…§éƒ¨ vs å¤–éƒ¨çš„å®šç¾©

#### ğŸ“ **å…§éƒ¨**ï¼ˆInternalï¼‰
**ç•¶å‰å‡½æ•¸æˆ–çµ„ä»¶ç¯„åœå…§çš„ä¸€åˆ‡**

#### ğŸŒ **å¤–éƒ¨**ï¼ˆExternalï¼‰
**ç•¶å‰å‡½æ•¸æˆ–çµ„ä»¶ç¯„åœå¤–çš„ä¸€åˆ‡**

### ğŸ¯ å…·é«”å€åˆ†æ¨™æº–

#### 1. **å‡½æ•¸å±¤ç´šçš„å…§å¤–éƒ¨**

```javascript
function calculateTotal(price, tax) {
  // âœ… å…§éƒ¨ï¼šå‡½æ•¸åƒæ•¸å’Œå±€éƒ¨è®Šæ•¸
  const total = price + tax
  
  // âŒ å¤–éƒ¨å½±éŸ¿ï¼šä¿®æ”¹å…¨åŸŸè®Šæ•¸
  window.globalCounter++  // å½±éŸ¿å¤–éƒ¨
  
  // âŒ å¤–éƒ¨å½±éŸ¿ï¼šä¿®æ”¹å‚³å…¥çš„ç‰©ä»¶
  price.value = 0  // å½±éŸ¿å¤–éƒ¨
  
  return total  // âœ… å…§éƒ¨ï¼šè¿”å›å€¼
}
```

#### 2. **Vue çµ„ä»¶å±¤ç´šçš„å…§å¤–éƒ¨**

```vue
<script setup lang="ts">
// âœ… å…§éƒ¨ï¼šçµ„ä»¶å…§çš„ç‹€æ…‹
const count = ref(0)
const message = ref('Hello')

// âœ… å…§éƒ¨ï¼šçµ„ä»¶å…§çš„è¨ˆç®—
const doubledCount = computed(() => count.value * 2)

// âŒ å¤–éƒ¨å½±éŸ¿ï¼šä¿®æ”¹ DOM
const updateTitle = () => {
  document.title = 'New Title'  // å½±éŸ¿å¤–éƒ¨
}

// âŒ å¤–éƒ¨å½±éŸ¿ï¼šAPI è«‹æ±‚
const fetchData = async () => {
  const data = await $fetch('/api/data')  // å½±éŸ¿å¤–éƒ¨ï¼ˆç¶²è·¯ï¼‰
  return data
}

// âŒ å¤–éƒ¨å½±éŸ¿ï¼šæœ¬åœ°å„²å­˜
const saveSettings = () => {
  localStorage.setItem('settings', 'value')  // å½±éŸ¿å¤–éƒ¨ï¼ˆç€è¦½å™¨ï¼‰
}
</script>
```

### ğŸ” åˆ¤æ–·å…§å¤–éƒ¨çš„å¯¦ç”¨æ–¹æ³•

#### æ–¹æ³• 1ï¼š**ã€Œå¦‚æœé€™å€‹å‡½æ•¸è¢«åˆªé™¤ï¼Œæœƒå½±éŸ¿ä»€éº¼ï¼Ÿã€**

```javascript
// âœ… å…§éƒ¨ï¼šåˆªé™¤å¾Œåªå½±éŸ¿å‡½æ•¸æœ¬èº«
function add(a, b) {
  return a + b
}

// âŒ å¤–éƒ¨ï¼šåˆªé™¤å¾Œæœƒå½±éŸ¿å…¶ä»–æ±è¥¿
function logMessage(msg) {
  console.log(msg)  // å½±éŸ¿æ§åˆ¶å°
  localStorage.setItem('log', msg)  // å½±éŸ¿ç€è¦½å™¨å„²å­˜
}
```

#### æ–¹æ³• 2ï¼š**ã€Œé€™å€‹æ“ä½œæœƒæ”¹è®Šå¤–éƒ¨ç’°å¢ƒå—ï¼Ÿã€**

```javascript
// âœ… å…§éƒ¨ï¼šåªæ”¹è®Šå‡½æ•¸å…§éƒ¨çš„å€¼
function processData(data) {
  const processed = data.map(item => item * 2)
  return processed
}

// âŒ å¤–éƒ¨ï¼šæœƒæ”¹è®Šå¤–éƒ¨ç’°å¢ƒ
function processData(data) {
  data.forEach(item => {
    item.value = item.value * 2  // æ”¹è®Šäº†å¤–éƒ¨å‚³å…¥çš„ç‰©ä»¶
  })
  return data
}
```

#### æ–¹æ³• 3ï¼š**ã€Œé€™å€‹æ“ä½œæ˜¯å¯è¦‹çš„å—ï¼Ÿã€**

```javascript
// âœ… å…§éƒ¨ï¼šå¤–éƒ¨çœ‹ä¸åˆ°è®ŠåŒ–
function calculateTax(price) {
  const taxRate = 0.1
  const tax = price * taxRate
  return tax
}

// âŒ å¤–éƒ¨ï¼šå¤–éƒ¨å¯ä»¥çœ‹åˆ°è®ŠåŒ–
function calculateTax(price) {
  const taxRate = 0.1
  const tax = price * taxRate
  
  // å¤–éƒ¨å¯ä»¥çœ‹åˆ°é€™äº›è®ŠåŒ–
  document.getElementById('tax-display').textContent = tax
  window.lastTaxCalculation = tax
  
  return tax
}
```

### ğŸ“ å¸¸è¦‹çš„å¤–éƒ¨å½±éŸ¿æ“ä½œ

```javascript
// é€™äº›éƒ½æ˜¯å¤–éƒ¨å½±éŸ¿
console.log()           // æ§åˆ¶å°
localStorage.setItem()   // ç€è¦½å™¨å„²å­˜
sessionStorage.setItem() // ç€è¦½å™¨å„²å­˜
document.title = ''      // DOM
fetch()                  // ç¶²è·¯
setTimeout()            // è¨ˆæ™‚å™¨
window.open()           // ç€è¦½å™¨è¦–çª—
```

### âœ… å¸¸è¦‹çš„å…§éƒ¨æ“ä½œ

```javascript
// é€™äº›éƒ½æ˜¯å…§éƒ¨æ“ä½œ
const result = a + b     // ç´”è¨ˆç®—
const filtered = array.filter()  // ç´”è¨ˆç®—
const sorted = array.sort()       // ç´”è¨ˆç®—ï¼ˆä¸ä¿®æ”¹åŸé™£åˆ—ï¼‰
return value             // è¿”å›å€¼
```

### ğŸ¯ å¿«é€Ÿåˆ¤æ–·æ³•

1. **å•è‡ªå·±**ï¼šã€Œé€™å€‹æ“ä½œæœƒè®“å¤–éƒ¨ç’°å¢ƒè®Šå¾—ä¸åŒå—ï¼Ÿã€
2. **æª¢æŸ¥**ï¼šæ˜¯å¦æœ‰ `console.log`ã€`localStorage`ã€`fetch`ã€`document` ç­‰
3. **æ€è€ƒ**ï¼šå¦‚æœé€™å€‹å‡½æ•¸è¢«å‘¼å«å¤šæ¬¡ï¼Œå¤–éƒ¨ç’°å¢ƒæœƒç´¯ç©è®ŠåŒ–å—ï¼Ÿ

---

## æ•ˆèƒ½è€ƒé‡

### `computed` æ•ˆèƒ½å„ªå‹¢
- **å¿«å–æ©Ÿåˆ¶**ï¼šä¾è³´ä¸è®Šæ™‚ä¸æœƒé‡æ–°è¨ˆç®—
- **æ‡¶æƒ°è¨ˆç®—**ï¼šåªæœ‰è¢«ä½¿ç”¨æ™‚æ‰è¨ˆç®—
- **ä¾è³´è¿½è¹¤**ï¼šåªè¿½è¹¤å¯¦éš›ä½¿ç”¨çš„ä¾è³´

### `watcher` æ•ˆèƒ½æ³¨æ„äº‹é …
- **ç„¡å¿«å–**ï¼šæ¯æ¬¡è§¸ç™¼éƒ½æœƒåŸ·è¡Œ
- **æ·±åº¦ç›£è½**ï¼šå¯èƒ½é€ æˆæ•ˆèƒ½å•é¡Œ
- **æ¸…ç†æ©Ÿåˆ¶**ï¼šè¨˜å¾—æ¸…ç†è¨ˆæ™‚å™¨ã€äº‹ä»¶ç›£è½å™¨ç­‰

---

## ç›¸é—œè³‡æº

- [Vue 3 Watchers å®˜æ–¹æ–‡ä»¶](https://vuejs.org/guide/essentials/watchers.html)
- [VueUse Watch å‡½æ•¸é›†åˆ](https://vueuse.org/functions.html#category=Watch)
- [Vue 3 Computed Properties å®˜æ–¹æ–‡ä»¶](https://vuejs.org/guide/essentials/computed.html)